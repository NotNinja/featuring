{"version":3,"file":"featuring.js","sources":["../src/featuring.js","../index.js"],"sourcesContent":["/*\n * Copyright (C) 2017 Alasdair Mercer, !ninja\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n'use strict';\n\n// TODO: Documentation\n\nvar features = {};\n\nvar globalFeatures = null;\n\nfunction Feature(name, scope) {\n  this._name = name;\n  this._scope = scope;\n}\n\nFeature.prototype = {\n\n  constructor: Feature,\n\n  active: function() {\n    var target = getMap(this._scope);\n\n    return Boolean(target && target[this._name]);\n  },\n\n  check: function() {\n    if (!this.active()) {\n      throw new Error(this._name + ' feature is not active');\n    }\n  },\n\n  when: function(func) {\n    var active = this.active();\n\n    if (active) {\n      func();\n    }\n\n    return active;\n  }\n\n};\n\nfunction featuring(name, scope) {\n  return new Feature(name, scope);\n}\n\nfeaturing.active = function(names, scope) {\n  if (isString(names)) {\n    names = [ names ];\n  }\n\n  var feature;\n\n  for (var i = 0, length = names.length; i < length; i++) {\n    feature = new Feature(names[i], scope);\n\n    if (!feature.active()) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\nfeaturing.check = function(names, scope) {\n  if (isString(names)) {\n    names = [ names ];\n  }\n\n  var feature;\n\n  for (var i = 0, length = names.length; i < length; i++) {\n    feature = new Feature(names[i], scope);\n    feature.check();\n  }\n};\n\nfeaturing.get = function(scope) {\n  return getNames(getMap(scope));\n};\n\nfeaturing.init = function(names, scope) {\n  if (isString(scope)) {\n    if (features[scope] != null) {\n      throw new Error('\"' + scope + '\" scope features have already been initialized');\n    }\n\n    features[scope] = createMap(names);\n  } else {\n    if (globalFeatures != null) {\n      throw new Error('Global features have already been initialized');\n    }\n\n    globalFeatures = createMap(names);\n  }\n};\n\nfeaturing.using = function(scope) {\n  var boundFeaturing = applyScope(featuring, scope);\n  applyScopeToAll(featuring, boundFeaturing, [\n    'active',\n    'check',\n    'get',\n    'init',\n    'when'\n  ], scope);\n\n  boundFeaturing.using = featuring.using;\n\n  return boundFeaturing;\n};\n\nfeaturing.when = function(names, scope, func) {\n  var active = featuring.active(names, scope);\n\n  if (active) {\n    func();\n  }\n\n  return active;\n};\n\nfunction applyScope(func, scope) {\n  return function() {\n    if (func.length === 1) {\n      return func(scope);\n    }\n\n    var names = arguments[0];\n    var rest = Array.prototype.slice.call(arguments, 1);\n\n    return func.apply(null, [ names, scope ].concat(rest));\n  };\n}\n\nfunction applyScopeToAll(source, target, names, scope) {\n  var name;\n\n  for (var i = 0, length = names.length; i < length; i++) {\n    name = names[i];\n    target[name] = applyScope(source[name], scope);\n  }\n}\n\nfunction createMap(names) {\n  if (isString(names)) {\n    names = [ names ];\n  }\n\n  var map = {};\n\n  for (var i = 0, length = names.length; i < length; i++) {\n    map[names[i]] = true;\n  }\n\n  return map;\n}\n\nfunction getMap(scope) {\n  return isString(scope) ? features[scope] : globalFeatures;\n}\n\nfunction getNames(map) {\n  var names = [];\n\n  for (var key in map) {\n    if (Object.prototype.hasOwnProperty.call(map, key)) {\n      names.push(key);\n    }\n  }\n\n  return names;\n}\n\nfunction isString(obj) {\n  return typeof obj === 'string';\n}\n\nmodule.exports = featuring;\n","/*\n * Copyright (C) 2017 Alasdair Mercer, !ninja\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n'use strict';\n\nmodule.exports = require('./src/featuring');\n"],"names":["require$$0"],"mappings":"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"}