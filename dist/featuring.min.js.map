{"version":3,"file":"featuring.min.js","sources":["../src/featuring.js"],"sourcesContent":["/*\n * Copyright (C) 2017 Alasdair Mercer, !ninja\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE.\n */\n\n'use strict';\n\n// TODO: Documentation\n\nvar features = {};\n\nvar globalFeatures = null;\n\nfunction Feature(name, scope) {\n  this._name = name;\n  this._scope = scope;\n}\n\nFeature.prototype = {\n\n  constructor: Feature,\n\n  active: function() {\n    var target = getMap(this._scope);\n\n    return Boolean(target && target[this._name]);\n  },\n\n  check: function() {\n    if (!this.active()) {\n      throw new Error(this._name + ' feature is not active');\n    }\n  },\n\n  when: function(func) {\n    var active = this.active();\n\n    if (active) {\n      func();\n    }\n\n    return active;\n  }\n\n};\n\nfunction featuring(name, scope) {\n  return new Feature(name, scope);\n}\n\nfeaturing.active = function(names, scope) {\n  if (isString(names)) {\n    names = [ names ];\n  }\n\n  var feature;\n\n  for (var i = 0, length = names.length; i < length; i++) {\n    feature = new Feature(names[i], scope);\n\n    if (!feature.active()) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\nfeaturing.check = function(names, scope) {\n  if (isString(names)) {\n    names = [ names ];\n  }\n\n  var feature;\n\n  for (var i = 0, length = names.length; i < length; i++) {\n    feature = new Feature(names[i], scope);\n    feature.check();\n  }\n};\n\nfeaturing.get = function(scope) {\n  return getNames(getMap(scope));\n};\n\nfeaturing.init = function(names, scope) {\n  if (isString(scope)) {\n    if (features[scope] != null) {\n      throw new Error('\"' + scope + '\" scope features have already been initialized');\n    }\n\n    features[scope] = createMap(names);\n  } else {\n    if (globalFeatures != null) {\n      throw new Error('Global features have already been initialized');\n    }\n\n    globalFeatures = createMap(names);\n  }\n};\n\nfeaturing.using = function(scope) {\n  var boundFeaturing = applyScope(featuring, scope);\n  applyScopeToAll(featuring, boundFeaturing, [\n    'active',\n    'check',\n    'get',\n    'init',\n    'when'\n  ], scope);\n\n  boundFeaturing.using = featuring.using;\n\n  return boundFeaturing;\n};\n\nfeaturing.when = function(names, scope, func) {\n  var active = featuring.active(names, scope);\n\n  if (active) {\n    func();\n  }\n\n  return active;\n};\n\nfunction applyScope(func, scope) {\n  return function() {\n    if (func.length === 1) {\n      return func(scope);\n    }\n\n    var names = arguments[0];\n    var rest = Array.prototype.slice.call(arguments, 1);\n\n    return func.apply(null, [ names, scope ].concat(rest));\n  };\n}\n\nfunction applyScopeToAll(source, target, names, scope) {\n  var name;\n\n  for (var i = 0, length = names.length; i < length; i++) {\n    name = names[i];\n    target[name] = applyScope(source[name], scope);\n  }\n}\n\nfunction createMap(names) {\n  if (isString(names)) {\n    names = [ names ];\n  }\n\n  var map = {};\n\n  for (var i = 0, length = names.length; i < length; i++) {\n    map[names[i]] = true;\n  }\n\n  return map;\n}\n\nfunction getMap(scope) {\n  return isString(scope) ? features[scope] : globalFeatures;\n}\n\nfunction getNames(map) {\n  var names = [];\n\n  for (var key in map) {\n    if (Object.prototype.hasOwnProperty.call(map, key)) {\n      names.push(key);\n    }\n  }\n\n  return names;\n}\n\nfunction isString(obj) {\n  return typeof obj === 'string';\n}\n\nmodule.exports = featuring;\n"],"names":["Feature","name","scope","this","_name","_scope","featuring","applyScope","func","length","names","arguments","rest","Array","prototype","slice","call","apply","concat","applyScopeToAll","source","target","i","createMap","isString","map","getMap","features","globalFeatures","getNames","key","Object","hasOwnProperty","push","obj","constructor","active","Boolean","check","Error","when","feature","get","init","using","boundFeaturing"],"mappings":"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"}